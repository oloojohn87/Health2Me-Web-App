<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Health2Me Technical Documentation</title>

    <!-- Core CSS - Include with every page -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!--<link href="font-awesome/css/font-awesome.css" rel="stylesheet">-->
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- Page-Level Plugin CSS - Dashboard -->
    <link href="css/plugins/morris/morris-0.4.3.min.css" rel="stylesheet">
    <link href="css/plugins/timeline/timeline.css" rel="stylesheet">

    <!-- SB Admin CSS - Include with every page -->
    <link href="css/sb-admin.css" rel="stylesheet">

</head>

<body>

    <div id="wrapper">

         <nav class="navbar navbar-default navbar-fixed-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".sidebar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">Health2Me Technical Documentation</a>
            </div>
            <!-- /.navbar-header -->

  

            <div class="navbar-default navbar-static-side" role="navigation">
                <div class="sidebar-collapse">
                    <ul class="nav" id="side-menu">
                        <li class="sidebar-search">
                            <div class="input-group custom-search-form">
                                <input type="text" class="form-control" placeholder="Search...">
                                <span class="input-group-btn">
                                <button class="btn btn-default" type="button">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                            </div>
                            <!-- /input-group -->
                        </li>
                        <li>
                            <a href="index.html"><i class="fa fa-book fa-fw"></i> Manual</a>
                        </li>
                        <li>
                            <a><i class="fa fa-database fa-fw"></i> Database Structure<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
		                               <li>
		                                    <a href="GoldenRules.html">Golden Rules of Report Access</a>
		                                </li>
		                               <li>
		                                    <a>Important Tables<span class="fa arrow"></span></a>
                                             <ul class="nav nav-second-level">
		                                       <li>
		                                          <a href="Database.html">Usuarios</a>
		                                        </li>
                                     
								              </ul>
		                                </li>
		                               
								 </ul>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-bar-chart-o fa-fw"></i> Documents<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li>
                                     <a href="Probes.html">Probes</a>
                                </li>
                                <li>
                                    <a href="GithubCommit.html">GitHub Commit Procedure</a>
                                </li>
                                <li>
                                    <a href="PhoneNumbers.html">Important Note for Phone Numbers</a>
                                </li>
                            </ul>
                            <!-- /.nav-second-level -->
                        </li>
                            <li>
                                 <a href="Probes.html"><i class="fa fa-gears fa-fw"></i> Startup Procedure<span class="fa arrow"></span></a>
								 <ul class="nav nav-second-level">
		                               <li>
		                                    <a href="Processes.html">Processes</a>
		                                </li>
		                               <li>
		                                    <a href="PhoneNumbers.html">Apache</a>
		                                </li>
		                               <li>
		                                    <a href="PhoneNumbers.html">MySQL</a>
		                                </li>
		                               <li>
		                                    <a href="PhoneNumbers.html">FTP Server</a>
		                                </li>
								 </ul>	 
                            </li>
                            <li>
                                 <a href="Channels.html"><i class="fa fa-arrows-alt fa-fw"></i> Channels</a>
                            </li>
							<li>
                             	 <a href="Database.html"><i class="fa fa-medkit fa-fw"></i> DICOM viewer</a>
							</li>
                        <li>
                             	 <a href="UbuntuInstallationSteps.html"><i class="fa fa-cloud-download fa-fw"></i> Ubuntu Installation</a>
							</li>
                        <li>
                             	 <a href="TurnServerInstallationSteps.html"><i class="fa fa-cloud-download fa-fw"></i> Turn Server Installation</a>
							</li>
                        
                        <li>
                             	 <a href="UbuntuUpdateSteps.html"><i class="fa fa-cloud-download fa-fw"></i> Server Restart and Package Update</a>
				        </li>
                        <li>
                             	 <a href="SessionHashing.html"><i class="fa fa-cog fa-fw"></i>Session Hashing</a>
							</li>    
                        <li>
                             	 <a><i class="fa fa-book fa-fw"></i> Libraries<span class="fa arrow"></span></a>
                                 <ul class="nav nav-second-level">
		                               <li>
		                                    <a>External Libraries<span class="fa arrow"></span></a>
                                               <ul class="nav nav-second-level">
                                                   <li>
		                                              <a href="timebar.html">Timebar</a>
		                                           </li>
                                                   <li>
		                                              <a href="Libraries.html">Moment.js</a>
		                                           </li>
                                               </ul>
		                                </li>
		                               <li>
		                                    <a>Internal Libraries<span class="fa arrow"></span></a>
		                                </li>
		                              
								 </ul>	
							</li>
                            <li>
                             	 <a href="H2MAPIs.html"><i class="fa fa-cog fa-fw"></i> Health2Me APIs</a>
							</li>
                   </ul>
                    <!-- /#side-menu -->
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h2 class="page-header">Turn Server Installation</h2>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                


<h4 class="text-primary">1.- Step 0 (Turn Server Installation) <span style="margin-left:20px;"></span></h4>
<p><br>->The first step of creating a turn server it to install the turn server which is done by running the following command.</br>
<br>->sudo apt-get install resiprocate-turn-server</br></p>
<h4 class="text-primary">1.- Step 1 (Configuration of Ports) <span style="margin-left:20px;"></span></h4>
<p><br>->Run the following command to configure the turnserver conf file</br>
<br>->sudo nano /etc/trunserver.conf</br>
<br>->listening-port=3478</br>
<br>->alt-listening-port=3478</br>
<br>->listening-ip=10.179.161.178</br>
</p>

<h4 class="text-primary">2.- Step 2(Retrieve and Setup Certificte and Keys for Turn Server) <span style="margin-left:20px;"></span></h4>
<p><br>-> We have to setup the certificate and keys for turn server. The certificate and keys can be found in the internet. We need to google for this. We can use the following certificate and keys which we configured for our turn server.</br>
<br>-> Put the following contents in turn_server_cert.pem file.</br>
<br>-> -----BEGIN CERTIFICATE-----
MIIDsDCCApgCCQCmgrJCiQlGOTANBgkqhkiG9w0BAQUFADCBmDELMAkGA1UEBhMC
VVMxCzAJBgNVBAgTAkNBMRUwEwYDVQQHEwxXYWxudXQgQ3JlZWsxHDAaBgNVBAoT
E1RVUk4gU2VydmVyIHByb2plY3QxFDASBgNVBAsTC0RldmVsb3BtZW50MQ0wCwYD
VQQDEwRPbGVnMSIwIAYJKoZIhvcNAQkBFhNtb20wNDAyNjdAZ21haWwuY29tMCAX
DTEyMTEyNTA4MjAxNloYDzIxMTIxMTAxMDgyMDE2WjCBmDELMAkGA1UEBhMCVVMx
CzAJBgNVBAgTAkNBMRUwEwYDVQQHEwxXYWxudXQgQ3JlZWsxHDAaBgNVBAoTE1RV
Uk4gU2VydmVyIHByb2plY3QxFDASBgNVBAsTC0RldmVsb3BtZW50MQ0wCwYDVQQD
EwRPbGVnMSIwIAYJKoZIhvcNAQkBFhNtb20wNDAyNjdAZ21haWwuY29tMIIBIjAN
BgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAv6bYkERhZ43RjW4EuqCaTq5g+D+l
JI/GwlVzdzQ3+F4clMQDR1kp1nX+9AvwjCXz3AYwY1H9CqjmjGM4R9uNJJseK/aJ
d2DUFADkF+7I674XwX8U2Fy5on9jqWq3jdbb8eg/awcTBdrNLWNPquwfS2KVdooj
9yPkqnO0c3ko1/OzIQCcs09O3l/MPt+aOsHk3B9l79ZRs3zWkylI+we0Fnc+7tZE
psCztA+KCCoiJf7NenOvVhdKg7D1AXuzJ/P/Euvc3+CIiS9HI4pWLopY1k+HydLe
IcopqSbg9CRIKe1HOL8YTvCm2ZoTqgijwWUlGtwEDf2xxUQX/TLYiW8JFQIDAQAB
MA0GCSqGSIb3DQEBBQUAA4IBAQATbrBOLV4e8Qmsby9+srxXsdbNc60PmDZ4WiZ1
IElfWmzM7wGXm9sJg1PX/7T24R1tbwZGLIhZnkhecG372GChULZJ9Pdjh0Ab2nK5
LRKHXTpjp/xOJvx0JMCIIyRnGZT1nABPOk8uEjNW8PaU6yhQ4f5nKaSOgYGRCln6
dcy5vylCsyD9Q7GXs0KOC38XD+Ycv6VLX4zKJ2Yum50Wt643nLjG9RlGT3FXWJ1K
HUbPC5TO6bcYLdiTjaYr+X8xC/x6h/Ngdo/16w7fRmQQ4uS+TVXrg8ITmI71KX/I
m7C9jbsubwzrhW84oZXYf+o/0ATtEAhiVLnHifKCCYikqfVj
-----END CERTIFICATE-----</br>
<br>-> Put the following contents in turn_server_pkey.pem file</br>
<br-> -----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAv6bYkERhZ43RjW4EuqCaTq5g+D+lJI/GwlVzdzQ3+F4clMQD
R1kp1nX+9AvwjCXz3AYwY1H9CqjmjGM4R9uNJJseK/aJd2DUFADkF+7I674XwX8U
2Fy5on9jqWq3jdbb8eg/awcTBdrNLWNPquwfS2KVdooj9yPkqnO0c3ko1/OzIQCc
s09O3l/MPt+aOsHk3B9l79ZRs3zWkylI+we0Fnc+7tZEpsCztA+KCCoiJf7NenOv
VhdKg7D1AXuzJ/P/Euvc3+CIiS9HI4pWLopY1k+HydLeIcopqSbg9CRIKe1HOL8Y
TvCm2ZoTqgijwWUlGtwEDf2xxUQX/TLYiW8JFQIDAQABAoIBADUPHCXUyKLCwKFH
NEf27sGZxX71H+NfaseioLT/3/8DDyagncfDB7I4OL2YEKC8YScpD3xv1n59BFcZ
oRtDzW+1AkVpm+VRCWYAWSXHFhkuJ6WKaVr9UOeMHStqQCcktP/kLKqU6s9UJDnM
pOHNPVzBjl+jHxHs/gGyxuKxSH2Anwkrzpiv5j0obKFnw3QtAqeZRs1NlvPtYt2S
eihZWr8r8LqylPk9ga9MYmO79Yr+EPVaqd6bmz4MpZJ4/7LEjx03Q6azdMCPhFNY
cYzPIDZFEj81Zj/tqA2MU/uTTUUrcXint4dHRJs34m5N68PV1Y1XhhH6FG0+X711
ZymudoECgYEA/ChS5zmmOoLoaq2441+PzQbDP45qR6+G4slHwC8RDZhsYw0hQnp9
n44Qagpt74J4FjxT20BdE714DZP32IqagUwatWRQ+z3UoGafkJSNc5JSEogwZ65C
nC8RI1pPHLEvE8IzBJiqUA1kbMOMfTYW694wdN9JVZang05/AXaJzm8CgYEAwpJ8
nJRR9JFweHRrRgnrVk0Qi+ABbN9T/nhPXYab2vjBfeBOTA1Mob0M3zMJDCnL2i+D
K1GzE6WaYHElr45j2Wfphd/rRTk74WR4BaPpTCGaAhBQNn0ufqUkKsCPEAlTU+nG
iyXP4OvdMPjEBckjbKm/mlX7m0njSHAY6SWNorsCgYEAi8Yubk3efwChpMC3hBIs
vBHLmSdwclwyAPRh+X4djdO4AQ/+J8OObytond86IVHJD0pRkW+UKKUWLzCeakIq
cxGknHgHC72yZ1d7i8FMx4uMQwmLC23lLn5ImbgtslHlLqavcRTPE6DY0hFzhtS8
z/JSGfbLx83C/V49uKnkqbECgYA6h1oYt70XdpCAi3ShcuZp5XCuwslq+JsJlyM4
nP9RFTcPKGQlGHMOzBGNKor0L7Z0gYpRg5f8tvoDPMX7UzfR9CIY9UyOXDMZD+HS
wIWzMwBi0olueqV7zy1b9uSSDFwWh+IDhXJM1GaLDqnYm7KeQ0mxoV+4TLej2KSF
rZg3dQKBgQCVrVxFV8jHBsRsH5PzMx6pUSAollmuyte9mGU1MIE7EZf+LEQIAjGZ
9jvtAILYVJXwVZv1/zNxldUfBNuWc95ft+Gg7FEN0p0uLpdYNXQUcXuJaJ9tJ1td
ZfvRcrUXdFNKYt9/yaGeHVaIQfp4W1faZD7OnII7EOVkUKyv/qNGAA==
-----END RSA PRIVATE KEY-----</br>
<br>-> We need to configure the turn server configuration file, turnserver.conf in /etc folder bu putting the follwing contents in the file.</br>
<br>-> #cert=/usr/local/etc/turn_server_cert.pem</br>
<br>-> #pkey=/usr/local/etc/turn_server_pkey.pem</br>
</p>

<h4 class="text-primary">3.- Step 3(Generating 32 character HEX password) <span style="margin-left:20px;"></span></h4>
<p><br>-> A 32 character HEX password needs to be setup which is obtained by running md5 hashing algorithm in the following manner on a given asci password string</br>
<br>-> md5(passowrd string)</br>
<br>->the md5 hash function can be run online on online php execution site and obtain the 32 character hex string</br>
</p>

<h4 class="text-primary">4.- Step 4(Adding users to users.txt)<span style="margin-left:20px;"></span></h4>
<p><br>-> We need to add user to the users.txt file which is done by running the following command</br>
<br>-> sudo nano /etc/reTurn/users.txt </br>
<br>-> Add the following line to the users.txt file</br>
<br>-> ITGroup:a0e828972364d59b03024eb38837fb86:beta.health2.me:authorized</br>
<br>->a0e828972364d59b03024eb38837fb86, is the 32 character hex string obtained in earlier step</br>
</p>

<h4 class="text-primary">5.- Step 5(Setting up javascript files) <span style="margin-left:20px;"></span></h4>
<p><br>->  We need to ensure that connections in javascript files are including the correct Turn paths</br>
<br>->  Edit the following files.</br>
<br>-> simplewebrtc.bundle.js
function SimpleWebRTC(opts) {
   var self = this;
   var options = opts || {};
   var config = this.config = {
           url: [{"stun:stun.l.google.com:19302"},
{"url": "turn:ITGroup@54.225.226.163:3478?transport=udp", "credential": "a0e828972364d59b03024eb38837fb86"},
{"url": "turn:ITGroup@54.225.226.163:3478?transport=tcp", "credential": "a0e828972364d59b03024eb38837fb86"}],
           debug: false,
           localVideoEl: '',
           remoteVideosEl: '',
           enableDataChannels: true,
           autoRequestMedia: false,
           autoRemoveVideos: true,
           adjustPeerVolume: true,
           peerVolumeWhenSpeaking: 0.25
       };
   var item, connection;</br>
<br>-> simplewebrtc.js
function SimpleWebRTC(opts) {
   var self = this;
   var options = opts || {};
   var config = this.config = {
           //url: 'http://signaling.simplewebrtc.com:8888',
           url: [{"stun:stun.l.google.com:19302"},
{"url": "turn:ITGroup@54.225.226.163:3478?transport=udp", "credential": "a0e828972364d59b03024eb38837fb86"},
{"url": "turn:ITGroup@54.225.226.163:3478?transport=tcp", "credential": "a0e828972364d59b03024eb38837fb86"}],
           debug: false,
           localVideoEl: '',
           remoteVideosEl: '',
           enableDataChannels: true,
           autoRequestMedia: false,
           autoRemoveVideos: true,
           adjustPeerVolume: true,
           peerVolumeWhenSpeaking: 0.25
       };
   var item, connection;</br>
<br>->latest.js
peerConnectionConfig:{iceServers:[{url:"stun:stun.l.google.com:19302"},
{"url": "turn:ITGroup@54.225.226.163:3478?transport=udp", "credential": "a0e828972364d59b03024eb38837fb86"},
{"url": "turn:ITGroup@54.225.226.163:3478?transport=tcp", "credential": "a0e828972364d59b03024eb38837fb86"}]}</br>
</p>

<h4 class="text-primary">6.- Step 6(Running the Turn server) <span style="margin-left:20px;"></span></h4>
<p><br>-> We need to run the turn server with the correct filepaths and ips'. Please note that the private ip AND the public ip are being used for this process </br>
<br>-> Run the following to start the turn server as background process</br>
<br>-> sudo turnserver --syslog -a -L 10.179.161.178 -X 54.225.226.163 -E 10.179.161.178 -f --min-port=32355 --max-port=65535 
--user=ITGroup:a0e828972364d59b03024eb38837fb86 -r ITGroup --cert=turn_server_cert.pem --pkey=turn_server_pkey.pem 
--log-file=stdout -v &</br>
<br>->The ampersand & at the end of the command makes the turn server process keeping running continuously at the background. </br>
<br>-> So, even if the user logs out of the server, the process would still be running.</br>
</p>


</br>
<p><i class="fa fa-wrench fa-fw" style="margin-right:10px;"></i><span>This page created by <span class="text-primary">Pallab Hazarika</span> on <span class="text-info">October 1, 2014</span></span></p>
<!--<p><i class="fa fa-edit fa-fw" style="margin-right:10px;"></i><span>This page last edited by <span class="text-primary">Javier Vinals</span> on <span class="text-info">June 26, 2014</span></span></p> -->
                </div>
            </div>
            <!-- /.row -->
        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- Core Scripts - Include with every page -->
    <script src="js/jquery-1.10.2.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>

    <!-- Page-Level Plugin Scripts - Dashboard -->
    <script src="js/plugins/morris/raphael-2.1.0.min.js"></script>
    <script src="js/plugins/morris/morris.js"></script>

    <!-- SB Admin Scripts - Include with every page -->
    <script src="js/sb-admin.js"></script>

    <!-- Page-Level Demo Scripts - Dashboard - Use for reference -->
    <script src="js/demo/dashboard-demo.js"></script>

</body>

</html>
